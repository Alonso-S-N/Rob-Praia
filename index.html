<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Controle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* ---- RESET / BASE ---- */
    *{box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;
      -webkit-tap-highlight-color:transparent;touch-action:manipulation;}
    body{margin:0;font-family:system-ui;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;
         justify-content:center;height:100vh;}
    h2{margin:0 0 .8rem;font-size:1.6rem;}

    /* ---- GRID DOS BOT√ïES ---- */
    .grid{display:grid;gap:8px;grid-template-columns:repeat(3,1fr);width:90vw;max-width:420px;}
    button{border:none;border-radius:50%;font-size:7vw;font-weight:bold;color:#fff;background:#333;
           aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;transition:background .15s;}
    button:active{background:#555;}
    .esteira{background:#fc0;color:#000;}
    .esteira:active{background:#fd5;}
    #st{background:#c00;}
  </style>
</head>
<body>
  <h2>üéÆ Controle</h2>

  <div class="grid">
    <span></span>
    <button id="fw" data-key="leftY" data-val="-1">‚ñ≤</button>
    <span></span>

    <button id="le" data-key="leftX" data-val="-1">‚óÄ</button>
    <button id="st" data-key="leftY" data-val="0">‚èπ</button>
    <button id="ri" data-key="leftX" data-val="1">‚ñ∂</button>

    <span></span>
    <button id="bk" data-key="leftY" data-val="1">‚ñº</button>
    <span></span>

    <!-- Esteira -->
    <button id="estFwd" data-key="esteira" data-val="1" class="esteira">‚ñ≤</button>
    <span></span>
    <button id="estRev" data-key="esteira" data-val="-1" class="esteira">‚ñº</button>
  </div>

  <script>
    const ws = new WebSocket("ws://10.91.63.162:8766");
    ws.onopen  = () => console.log("‚úÖ Conectado");
    ws.onerror = e => console.error("‚ùå", e);

    function send(key,val){
      if (ws.readyState === WebSocket.OPEN){
        ws.send(JSON.stringify({action:"put",table:"phone",key:key,value:val}));
        console.log("PUT",key,val);
      }
    }

    /* ---- VINCULA BOT√ïES ---- */
    document.querySelectorAll("button").forEach(btn => {
      const k = btn.dataset.key;
      const v = Number(btn.dataset.val);

      function start(e){ e.preventDefault(); send(k,v); }
      function stop (e){ e.preventDefault(); send(k,0); }

      btn.addEventListener("touchstart", start, {passive:false});
      btn.addEventListener("touchend"  , stop , {passive:false});
      btn.addEventListener("touchcancel", stop , {passive:false});
      /* fallback mouse */
      btn.addEventListener("mousedown", start);
      btn.addEventListener("mouseup"  , stop );
      btn.addEventListener("mouseleave", stop ); // segurar e arrastar fora
    });
  </script>
</body>
</html>